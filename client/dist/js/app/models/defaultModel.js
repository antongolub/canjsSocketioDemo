define(["can","socket"],function(e,t){return function(r,n){var i;return"string"==typeof r?(i=e.Model.extend(n,{create:function(n){var i=e.Deferred(),d=this;return t.emit(r+"::create",$.extend({},d._data,n),{},function(e,t){d.attr(t),i.resolve(t)}),i},findOne:function(n,i){var d=e.Deferred(),o=this;return t.emit(r+"::get",n,i,function(e,t){o.attr(t),d.resolve(t)}),d},findAll:function(n){var i=e.Deferred(),d=this;return t.emit(r+"::find",n,function(e,t){d.attr("list",t),i.resolve(t)}),i},update:function(n,i){var d=e.Deferred(),o=this;return t.emit(r+"::update",n||o._data.id,$.extend({},o._data,i),{},function(e,t){o.attr(t),d.resolve(t)}),d},destroy:function(n){var i=e.Deferred(),d=this;return t.emit(r+"::remove",n||d._data.id,{},function(e,t){i.resolve(t)}),i}}),t.on(r+" updated",function(t){e.trigger(i,"updated",t)}),t.on(r+" created",function(t){e.trigger(i,"created",t)}),t.on(r+" removed",function(t){e.trigger(i,"destroyed",t)})):i=e.Model,i}});